#!/bin/python3
import subprocess
import shlex
import argparse
import os

def ip_target(target):
	string=""
	resultado= execute(target)
	resultado = str(resultado)
	with open("buffer-ip-target","w") as file:
		file.write(resultado)
	with open("buffer-ip-target",'r') as file:
		saida = file.read()
	os.remove("./buffer-ip-target")
	ipv6 = saida.split("IPv6: ")[1]
	ipv6 = ipv6.split("\\n")[0]
	ipv4 = saida.split("IPv4: ")[1]
	ipv4 = ipv4.split("\\n")[0]
	return ipv4, ipv6

def arguments():
	parser = argparse.ArgumentParser(description="««get_ipv»»")
	parser.add_argument('-t','--target',help="spicify the target URL")
	parser.add_argument('-f','--file',help="spcify the file with targets URLs")
	args = parser.parse_args()
	return args

def execute(url):
	try:
		host = url.split("https://")[1]
	except:
		host = url.split("http://")[1]
	host = host.split("/")[0]
	comando = f"""curl --path-as-is -i -v -k -X 'GET' -H 'Host: {host}' -H 'Sec-Ch-Ua: \"Not?A_Brand\";v=\"99\", \"Chromium\";v=\"130\"' -H 'Sec-Ch-Ua-Mobile: ?0' -H 'Sec-Ch-Ua-Platform: \"Linux\"' -H 'Accept-Language: en-US,en;q=0.9' -H 'Upgrade-Insecure-Requests: 1' -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.6723.70 Safari/537.36' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7' -H 'Sec-Fetch-Site: none' -H 'Sec-Fetch-Mode: navigate' -H 'Sec-Fetch-User: ?1' -H 'Sec-Fetch-Dest: document' -H 'Accept-Encoding: gzip, deflate, br' -H 'Priority: u=0, i' -H 'Connection: keep-alive' '{url}'"""
	args = shlex.split(comando)
	resultado = subprocess.run(args, capture_output=True, text=True)
	return resultado
def main():
	args = arguments()
	if args.target:
		string=""
		resultado= execute(args.target)
		resultado = str(resultado)
		with open("buffer-target","w") as file:
			file.write(resultado)
		with open("buffer-target",'r') as file:
			saida = file.read()
		os.remove("./buffer-target")
		ipv6 = saida.split("IPv6: ")[1]
		ipv6 = ipv6.split("\\n")[0]
		print(f'ipv6\t{ipv6}')
		ipv4 = saida.split("IPv4: ")[1]
		ipv4 = ipv4.split("\\n")[0]
		print(f'ipv4\t{ipv4}')
	elif args.file:
		with open(args.file,'r') as file:
			content  = file.read()
		content_list = content.split("\n")
		for url in content_list:
			ipv4, ipv6 = ip_target(url)
			print(f'ipv4 {ipv4}')
			print(f'ipv6 {ipv6}')
			ipv4_list = ipv4.split(", ")
			for target_ivp4 in ipv4_list:
				cmd = "geolocalization -t {target_ivp4}"
				argumentos = 
		print(content_list)
		os.remove(args.file)
if __name__ == '__main__':main	();
